<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥¬çš„æ¸©é¦¨æ—¶å…‰ç›¸å†Œ - å¥½å‹æ¡£æ¡ˆç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #A8E6CF;
            --secondary-color: #FFD3B6;
            --accent-color: #FFAAA5;
            --light-color: #FFE8E8;
            --dark-color: #7C9EB2;
            --text-color: #5A5A5A;
            --shadow: 0 8px 20px rgba(168, 230, 207, 0.3);
            --round: 25px;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--text-color);
            font-family: 'ZCOOL XiaoWei', serif;
            position: relative;
            overflow-x: hidden;
        }
        
        /* èƒŒæ™¯è£…é¥°å…ƒç´  */
        .decoration {
            position: fixed;
            z-index: -1;
            font-size: 3rem;
            opacity: 0.1;
            animation: float 8s infinite ease-in-out;
        }
        
        .dec-1 { top: 10%; left: 5%; animation-delay: 0s; }
        .dec-2 { top: 20%; right: 8%; animation-delay: 1s; }
        .dec-3 { bottom: 15%; left: 7%; animation-delay: 2s; }
        .dec-4 { bottom: 25%; right: 12%; animation-delay: 3s; }
        .dec-5 { top: 40%; left: 15%; animation-delay: 4s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            background-color: rgba(255, 255, 255, 0.97);
            border-radius: var(--round);
            box-shadow: var(--shadow);
            overflow: hidden;
            backdrop-filter: blur(5px);
            border: 8px solid var(--light-color);
        }
        
        header {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "ğŸ¥¬ğŸ¥¬ğŸ¥¬ğŸ¥¬ğŸ¥¬ğŸ¥¬ğŸ¥¬ğŸ¥¬ğŸ¥¬ğŸ¥¬ğŸ¥¬ğŸ¥¬ğŸ¥¬ğŸ¥¬";
            position: absolute;
            top: 10px;
            left: 0;
            font-size: 1.5rem;
            opacity: 0.2;
            white-space: nowrap;
        }
        
        .title-container {
            position: relative;
            z-index: 2;
        }
        
        header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            font-family: 'Ma Shan Zheng', cursive;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            color: #5A5A5A;
        }
        
        header h1 span {
            color: #FF7A7A;
        }
        
        header p {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .view-switcher {
            display: flex;
            justify-content: center;
            background-color: var(--light-color);
            padding: 15px;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .view-btn {
            padding: 15px 35px;
            font-size: 1.2rem;
            font-weight: 600;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 50px;
            margin: 0 15px;
            transition: all 0.4s ease;
            color: var(--text-color);
            position: relative;
            overflow: hidden;
            font-family: 'Ma Shan Zheng', cursive;
        }
        
        .view-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
            z-index: -1;
            border-radius: 50px;
            transform: translateY(100%);
            transition: transform 0.4s ease;
        }
        
        .view-btn.active::before {
            transform: translateY(0);
        }
        
        .view-btn.active {
            color: white;
            box-shadow: 0 5px 15px rgba(255, 170, 165, 0.4);
        }
        
        .view-btn:hover:not(.active) {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(168, 230, 207, 0.4);
        }
        
        .view-btn i {
            margin-right: 10px;
        }
        
        .view-container {
            display: none;
            padding: 30px;
            min-height: 600px;
        }
        
        .view-container.active {
            display: block;
        }
        
        .admin-view, .user-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 1200px) {
            .admin-view, .user-view {
                grid-template-columns: 1fr;
            }
        }
        
        .section {
            background-color: white;
            border-radius: var(--round);
            padding: 30px;
            box-shadow: 0 8px 20px rgba(168, 230, 207, 0.2);
            border: 3px solid var(--light-color);
            transition: transform 0.3s ease;
        }
        
        .section:hover {
            transform: translateY(-5px);
        }
        
        .section-title {
            color: var(--accent-color);
            font-size: 1.8rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px dotted var(--primary-color);
            display: flex;
            align-items: center;
            font-family: 'Ma Shan Zheng', cursive;
        }
        
        .section-title i {
            margin-right: 15px;
            background-color: var(--light-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 1.1rem;
            font-family: 'Ma Shan Zheng', cursive;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid var(--primary-color);
            border-radius: 15px;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: 'ZCOOL XiaoWei', serif;
            background-color: rgba(168, 230, 207, 0.1);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(255, 170, 165, 0.2);
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .btn {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: 'Ma Shan Zheng', cursive;
            box-shadow: 0 5px 15px rgba(168, 230, 207, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 170, 165, 0.4);
        }
        
        .btn i {
            margin-right: 10px;
        }
        
        /* è¿”å›æŒ‰é’®æ ·å¼ */
        .back-btn {
            background: linear-gradient(90deg, var(--dark-color) 0%, #7C9EB2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: 'Ma Shan Zheng', cursive;
            box-shadow: 0 5px 15px rgba(124, 158, 178, 0.4);
            margin-bottom: 20px;
        }
        
        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(124, 158, 178, 0.4);
        }
        
        .back-btn i {
            margin-right: 8px;
        }
        
        /* å¤šç…§ç‰‡ä¸Šä¼ åŒºåŸŸ */
        .photos-upload {
            border: 3px dashed var(--primary-color);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 25px;
            background-color: rgba(168, 230, 207, 0.1);
        }
        
        .photos-upload:hover {
            border-color: var(--accent-color);
            background-color: rgba(255, 211, 182, 0.2);
        }
        
        .photos-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .photo-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .photo-item:hover {
            transform: scale(1.05);
        }
        
        .photo-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }
        
        .photo-info {
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            font-size: 0.85rem;
            color: var(--dark-color);
        }
        
        .photo-time {
            font-size: 0.75rem;
            color: #999;
            margin-top: 5px;
        }
        
        .remove-photo {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: rgba(255, 170, 165, 0.9);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .remove-photo:hover {
            background-color: rgba(255, 122, 122, 1);
            transform: scale(1.1);
        }
        
        .friend-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .friend-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            background: linear-gradient(90deg, rgba(168, 230, 207, 0.1) 0%, rgba(255, 211, 182, 0.1) 100%);
            border-left: 6px solid var(--accent-color);
            transition: all 0.3s;
        }
        
        .friend-item:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 15px rgba(255, 170, 165, 0.2);
        }
        
        /* çº¯è‰²å¤´åƒæ ·å¼ */
        .friend-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 20px;
            border: 4px solid var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            font-family: 'Ma Shan Zheng', cursive;
        }
        
        /* çº¯è‰²å¤´åƒé¢œè‰²é…ç½® */
        .avatar-color-1 { background: linear-gradient(135deg, #FFAAA5 0%, #FF7A7A 100%); }
        .avatar-color-2 { background: linear-gradient(135deg, #A8E6CF 0%, #7C9EB2 100%); }
        .avatar-color-3 { background: linear-gradient(135deg, #FFD3B6 0%, #FFAAA5 100%); }
        .avatar-color-4 { background: linear-gradient(135deg, #7C9EB2 0%, #A8E6CF 100%); }
        .avatar-color-5 { background: linear-gradient(135deg, #FFE8E8 0%, #FFD3B6 100%); color: var(--text-color); }
        .avatar-color-6 { background: linear-gradient(135deg, #A8E6CF 0%, #FFAAA5 100%); }
        
        .friend-info h4 {
            margin-bottom: 8px;
            color: var(--dark-color);
            font-size: 1.3rem;
            font-family: 'Ma Shan Zheng', cursive;
        }
        
        .friend-info p {
            color: var(--text-color);
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .friend-actions {
            margin-left: auto;
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--light-color);
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--accent-color);
            font-size: 1.2rem;
        }
        
        .action-btn:hover {
            background-color: var(--accent-color);
            color: white;
            transform: scale(1.1);
        }
        
        /* æ—¶å…‰çº¿æ ·å¼ */
        .timeline {
            position: relative;
            padding: 20px 0;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .timeline-item {
            display: flex;
            margin-bottom: 25px;
            position: relative;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 30px;
            top: 0;
            bottom: -25px;
            width: 2px;
            background-color: var(--primary-color);
        }
        
        .timeline-item:last-child::before {
            display: none;
        }
        
        .timeline-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            position: relative;
            z-index: 2;
            border: 3px solid var(--primary-color);
            color: var(--accent-color);
            font-size: 1.5rem;
        }
        
        .timeline-content {
            flex: 1;
            background-color: rgba(168, 230, 207, 0.1);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid var(--accent-color);
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }
        
        .timeline-sender {
            font-weight: 600;
            color: var(--accent-color);
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.2rem;
        }
        
        .timeline-time {
            color: var(--dark-color);
            font-size: 0.9rem;
        }
        
        .timeline-message {
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .timeline-photos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .timeline-photo {
            border-radius: 10px;
            overflow: hidden;
            height: 120px;
            position: relative;
        }
        
        .timeline-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .timeline-photo:hover img {
            transform: scale(1.1);
        }
        
        .timeline-photo-time {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 0.7rem;
            padding: 3px 8px;
            text-align: center;
        }
        
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: var(--dark-color);
        }
        
        .no-data i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            opacity: 0.7;
        }
        
        .no-data p {
            font-size: 1.2rem;
            margin-top: 15px;
        }
        
        .user-search {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .user-search input {
            flex: 1;
        }
        
        /* ä¼˜åŒ–å¥½å‹å¤´åƒæ˜¾ç¤º */
        .friend-profile {
            padding: 20px 0;
            text-align: center;
        }
        
        .friend-avatar-container {
            position: relative;
            display: inline-block;
            margin-bottom: 25px;
        }
        
        .friend-avatar-container::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color), var(--secondary-color));
            border-radius: 50%;
            z-index: -1;
            animation: rotate 10s linear infinite;
        }
        
        .friend-avatar-container::after {
            content: 'ğŸ¥¬';
            position: absolute;
            top: -15px;
            right: -15px;
            background-color: var(--accent-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 5px 15px rgba(255, 170, 165, 0.4);
            z-index: 2;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .friend-profile-img {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            object-fit: cover;
            border: 12px solid white;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 72px;
            font-weight: bold;
            color: white;
            font-family: 'Ma Shan Zheng', cursive;
        }
        
        .friend-profile-img:hover {
            transform: scale(1.05);
        }
        
        .friend-profile h3 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--dark-color);
            font-family: 'Ma Shan Zheng', cursive;
            text-align: center;
            position: relative;
            display: inline-block;
            padding: 0 20px;
        }
        
        .friend-profile h3::before,
        .friend-profile h3::after {
            content: 'ğŸ¥¬';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            opacity: 0.7;
        }
        
        .friend-profile h3::before {
            left: -10px;
        }
        
        .friend-profile h3::after {
            right: -10px;
        }
        
        .friend-profile p {
            color: var(--text-color);
            line-height: 1.8;
            margin-bottom: 25px;
            font-size: 1.2rem;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 30px;
            border-radius: 15px;
            color: white;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: slideIn 0.5s ease;
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            max-width: 400px;
        }
        
        .notification::before {
            margin-right: 15px;
            font-size: 1.5rem;
        }
        
        .notification.success {
            background: linear-gradient(90deg, var(--primary-color) 0%, #7C9EB2 100%);
        }
        
        .notification.success::before {
            content: 'ğŸ¥¬';
        }
        
        .notification.error {
            background: linear-gradient(90deg, #FFAAA5 0%, #FF7A7A 100%);
        }
        
        .notification.error::before {
            content: 'âš ï¸';
        }
        
        .notification.info {
            background: linear-gradient(90deg, #7C9EB2 0%, #A8E6CF 100%);
        }
        
        .notification.info::before {
            content: 'ğŸ’¬';
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        footer {
            text-align: center;
            padding: 25px;
            color: var(--dark-color);
            font-size: 1rem;
            border-top: 3px dotted var(--primary-color);
            background-color: rgba(255, 232, 232, 0.5);
        }
        
        .password-section {
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(90deg, rgba(168, 230, 207, 0.1) 0%, rgba(255, 211, 182, 0.1) 100%);
            border-radius: 15px;
            border: 3px solid var(--light-color);
        }
        
        .hidden {
            display: none;
        }
        
        .greeting {
            font-size: 1.5rem;
            text-align: center;
            margin-top: 20px;
            color: var(--accent-color);
            font-family: 'Ma Shan Zheng', cursive;
        }
        
        /* ç…§ç‰‡è®¡æ•°å™¨ */
        .photos-count {
            display: inline-block;
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            text-align: center;
            line-height: 25px;
            font-size: 0.9rem;
            margin-left: 10px;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(168, 230, 207, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--accent-color) 100%);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--accent-color) 0%, #FF7A7A 100%);
        }
        
        /* æ—¶é—´çº¿è¿‡æ»¤å™¨ */
        .timeline-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background-color: var(--light-color);
            border: 2px solid var(--primary-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Ma Shan Zheng', cursive;
            color: var(--dark-color);
        }
        
        .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .filter-btn:hover:not(.active) {
            background-color: rgba(168, 230, 207, 0.3);
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: white;
            border-radius: var(--round);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 8px solid var(--light-color);
            transform: translateY(-50px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px dotted var(--primary-color);
        }
        
        .modal-title {
            color: var(--accent-color);
            font-size: 1.8rem;
            font-family: 'Ma Shan Zheng', cursive;
            display: flex;
            align-items: center;
        }
        
        .modal-title i {
            margin-right: 15px;
            background-color: var(--light-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--accent-color);
            cursor: pointer;
            transition: all 0.3s;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            background-color: var(--light-color);
            transform: rotate(90deg);
        }
        
        /* å·²ä¸Šä¼ ç…§ç‰‡ç½‘æ ¼ */
        .existing-photos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .existing-photo-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .existing-photo-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }
        
        .existing-photo-time {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 0.7rem;
            padding: 3px 8px;
            text-align: center;
        }
        
        .remove-existing-photo {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background-color: rgba(255, 170, 165, 0.9);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 0.8rem;
        }
        
        .remove-existing-photo:hover {
            background-color: rgba(255, 122, 122, 1);
            transform: scale(1.1);
        }
        
        /* é¡¶éƒ¨è¿”å›æŒ‰é’® */
        .top-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .top-header h2 {
            margin: 0;
            color: var(--accent-color);
            font-family: 'Ma Shan Zheng', cursive;
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯è£…é¥°å…ƒç´  -->
    <div class="decoration dec-1">ğŸ¥¬</div>
    <div class="decoration dec-2">ğŸ¥¬</div>
    <div class="decoration dec-3">ğŸ¥¬</div>
    <div class="decoration dec-4">ğŸ¥¬</div>
    <div class="decoration dec-5">ğŸ¥¬</div>
    
    <div class="container">
        <header>
            <div class="title-container">
                <h1><span>ğŸ¥¬</span> çš„å°å®‡å®™ <span>ğŸ¥¬</span></h1>
                <p>è®°å½•ğŸ¥¬å’Œæœ‹å‹ä»¬çš„ç¾å¥½ç¬é—´ï¼Œä¸Šä¼ ç…§ç‰‡å’Œç•™è¨€ï¼Œç•™ä¸‹æ¸©æš–å›å¿†ï¼</p>
                <div class="greeting">æ¬¢è¿æ¥åˆ°ğŸ¥¬çš„æ¸©é¦¨æ—¶å…‰å°å±‹ï¼</div>
            </div>
        </header>
        
        <div class="view-switcher">
            <button class="view-btn active" id="admin-btn">
                <i class="fas fa-heart"></i> ğŸ¥¬çš„ç®¡ç†ç©ºé—´
            </button>
            <button class="view-btn" id="user-btn">
                <i class="fas fa-user-friends"></i> æœ‹å‹æ¥è®¿å…¥å£
            </button>
        </div>
        
        <!-- ç®¡ç†å‘˜è§†è§’ -->
        <div class="view-container active" id="admin-view">
            <div class="password-section" id="password-section">
                <h3 class="section-title"><i class="fas fa-lock"></i> ğŸ¥¬çš„èº«ä»½éªŒè¯</h3>
                <div class="input-group">
                    <label for="admin-password">è¯·è¾“å…¥ğŸ¥¬çš„ä¸“å±å¯†ç </label>
                    <input type="password" id="admin-password" placeholder="åªæœ‰ğŸ¥¬çŸ¥é“çš„ç¥ç§˜å¯†ç ...">
                </div>
                <button class="btn" id="login-btn">
                    <i class="fas fa-door-open"></i> è¿›å…¥ğŸ¥¬çš„æ—¶å…‰å°å±‹
                </button>
            </div>
            
            <div class="admin-view hidden" id="admin-content">
                <div class="top-header">
                    <h2><i class="fas fa-heart"></i> ğŸ¥¬çš„ç®¡ç†ç©ºé—´</h2>
                    <button class="back-btn" id="admin-back-btn">
                        <i class="fas fa-arrow-left"></i> è¿”å›ç™»å½•
                    </button>
                </div>
                
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-book-medical"></i> åˆ›å»ºå¥½å‹æ¡£æ¡ˆ</h2>
                    <form id="friend-form">
                        <div class="input-group">
                            <label for="friend-name">å¥½å‹å§“å</label>
                            <input type="text" id="friend-name" placeholder="è¯·è¾“å…¥å¥½å‹çš„å¯çˆ±åå­—" required>
                        </div>
                        
                        <div class="input-group">
                            <label for="admin-message">ğŸ¥¬æƒ³å¯¹ä½ è¯´</label>
                            <textarea id="admin-message" placeholder="è¾“å…¥ğŸ¥¬æƒ³å¯¹å¥½å‹è¯´çš„æ‚„æ‚„è¯..."></textarea>
                        </div>
                        
                        <div class="input-group">
                            <label>ä¸Šä¼ å¥½å‹çš„ç¾ç…§ <span id="photos-count" class="photos-count">0</span></label>
                            <div class="photos-upload" id="photos-upload">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #A8E6CF; margin-bottom: 15px;"></i>
                                <p>ç‚¹å‡»æ­¤å¤„ä¸Šä¼ å¥½å‹çš„å¯çˆ±ç…§ç‰‡ï¼ˆæ”¯æŒå¤šé€‰ï¼‰</p>
                                <p style="font-size: 0.9rem; color: #7C9EB2; margin-top: 5px;">æŒ‰ä½ Ctrl æˆ– Shift é”®å¯ä»¥é€‰æ‹©å¤šå¼ ç…§ç‰‡</p>
                            </div>
                            <input type="file" id="photos-input" accept="image/*" multiple style="display: none;">
                            <div id="photos-preview" class="photos-preview">
                                <!-- ç…§ç‰‡é¢„è§ˆå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        
                        <button type="submit" class="btn">
                            <i class="fas fa-heart"></i> ä¿å­˜å¥½å‹æ¡£æ¡ˆ
                        </button>
                    </form>
                </div>
                
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-book-open"></i> å·²åˆ›å»ºçš„å¥½å‹æ¡£æ¡ˆ</h2>
                    <div class="friend-list" id="friend-list">
                        <!-- å¥½å‹åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        <div class="no-data">
                            <i class="fas fa-users"></i>
                            <p>è¿˜æ²¡æœ‰å¥½å‹æ¡£æ¡ˆï¼Œå¿«ä¸ºä½ çš„æœ‹å‹åˆ›å»ºä¸€ä¸ªå§ï¼</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç”¨æˆ·è§†è§’ -->
        <div class="view-container" id="user-view">
            <div class="user-view">
                <div class="section">
                    <div class="top-header">
                        <h2><i class="fas fa-search-heart"></i> æŸ¥æ‰¾ä½ çš„æ¡£æ¡ˆ</h2>
                        <button class="back-btn hidden" id="user-back-btn">
                            <i class="fas fa-arrow-left"></i> è¿”å›æœç´¢
                        </button>
                    </div>
                    
                    <div class="user-search">
                        <input type="text" id="user-name" placeholder="è¯·è¾“å…¥ä½ çš„åå­—">
                        <button class="btn" id="search-btn">
                            <i class="fas fa-search"></i> å¯»æ‰¾ğŸ¥¬çš„ç•™è¨€
                        </button>
                    </div>
                    
                    <div id="user-result">
                        <div class="no-data">
                            <i class="fas fa-heart"></i>
                            <p>è¾“å…¥ä½ çš„åå­—ï¼Œçœ‹çœ‹ğŸ¥¬ç»™ä½ ç•™äº†ä»€ä¹ˆè¯</p>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-history"></i> ğŸ¥¬çš„æ¸©é¦¨æ—¶å…‰çº¿</h2>
                    <div class="timeline-filter" id="timeline-filter">
                        <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                        <button class="filter-btn" data-filter="message">ç•™è¨€</button>
                        <button class="filter-btn" data-filter="photo">ç…§ç‰‡</button>
                    </div>
                    <div id="timeline-section">
                        <div class="no-data">
                            <i class="fas fa-clock"></i>
                            <p>æ‰¾åˆ°ä½ çš„æ¡£æ¡ˆåï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ğŸ¥¬ä¸ºä½ è®°å½•çš„æ—¶å…‰</p>
                        </div>
                    </div>
                    
                    <div class="hidden" id="new-message-section">
                        <div class="input-group">
                            <label for="user-message">ç»™ğŸ¥¬çš„ç•™è¨€</label>
                            <textarea id="user-message" placeholder="æƒ³å¯¹ğŸ¥¬è¯´äº›ä»€ä¹ˆå‘¢ï¼Ÿ"></textarea>
                        </div>
                        <button class="btn" id="send-message-btn">
                            <i class="fas fa-paper-plane"></i> å‘é€ç»™ğŸ¥¬
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Â© ğŸ¥¬çš„æ¸©é¦¨æ—¶å…‰ç›¸å†Œ | æ‰€æœ‰æ•°æ®éƒ½ä¼šä¿å­˜åœ¨ä½ çš„æµè§ˆå™¨ä¸­ï¼Œè¯·æ”¾å¿ƒä½¿ç”¨</p>
            <p style="margin-top: 10px;">ğŸ¥¬ ä¼šä¸€ç›´è®°å½•ä¸æ¯ä½æœ‹å‹çš„ç¾å¥½æ—¶å…‰ ğŸ¥¬</p>
        </footer>
    </div>
    
    <!-- å¥½å‹ç®¡ç†æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="manage-friend-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-user-edit"></i> ç®¡ç†å¥½å‹æ¡£æ¡ˆ</h3>
                <button class="close-modal" id="close-manage-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-content">
                <div class="input-group">
                    <label>å¥½å‹å§“å</label>
                    <input type="text" id="manage-friend-name" readonly>
                </div>
                
                <div class="input-group">
                    <label>ğŸ¥¬çš„ç•™è¨€ï¼ˆå¯ç¼–è¾‘ï¼‰</label>
                    <textarea id="manage-admin-message" placeholder="ç¼–è¾‘ğŸ¥¬æƒ³å¯¹å¥½å‹è¯´çš„è¯..."></textarea>
                </div>
                
                <div class="input-group">
                    <label>å·²ä¸Šä¼ çš„ç…§ç‰‡</label>
                    <div class="existing-photos" id="existing-photos">
                        <!-- å·²æœ‰ç…§ç‰‡å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
                
                <div class="input-group">
                    <label>æ·»åŠ æ–°ç…§ç‰‡ <span id="manage-photos-count" class="photos-count">0</span></label>
                    <div class="photos-upload" id="manage-photos-upload">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #A8E6CF; margin-bottom: 15px;"></i>
                        <p>ç‚¹å‡»æ­¤å¤„æ·»åŠ æ–°ç…§ç‰‡ï¼ˆæ”¯æŒå¤šé€‰ï¼‰</p>
                        <p style="font-size: 0.9rem; color: #7C9EB2; margin-top: 5px;">æŒ‰ä½ Ctrl æˆ– Shift é”®å¯ä»¥é€‰æ‹©å¤šå¼ ç…§ç‰‡</p>
                    </div>
                    <input type="file" id="manage-photos-input" accept="image/*" multiple style="display: none;">
                    <div id="manage-photos-preview" class="photos-preview">
                        <!-- æ–°ç…§ç‰‡é¢„è§ˆå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="input-group">
                    <label>ğŸ¥¬çš„æ–°ç•™è¨€</label>
                    <textarea id="manage-new-message" placeholder="æ·»åŠ ä¸€æ¡æ–°çš„ç•™è¨€..."></textarea>
                </div>
                
                <div class="input-group" style="display: flex; gap: 15px;">
                    <button class="btn" id="save-manage-btn">
                        <i class="fas fa-save"></i> ä¿å­˜æ›´æ”¹
                    </button>
                    <button class="btn" id="add-message-btn" style="background: linear-gradient(90deg, #7C9EB2 0%, #A8E6CF 100%);">
                        <i class="fas fa-comment"></i> ä»…æ·»åŠ ç•™è¨€
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- é€šçŸ¥ç»„ä»¶ -->
    <div id="notification-container"></div>
    
    <script>
        // ç­‰å¾…DOMå®Œå…¨åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            
            console.log("ğŸ¥¬ é¡µé¢è„šæœ¬å·²æˆåŠŸåŠ è½½");
            
            // çº¯è‰²å¤´åƒé¢œè‰²æ•°ç»„
            const avatarColors = [
                'avatar-color-1',
                'avatar-color-2', 
                'avatar-color-3',
                'avatar-color-4',
                'avatar-color-5',
                'avatar-color-6'
            ];
            
            // æ ¹æ®åå­—è·å–å¤´åƒé¢œè‰²
            function getAvatarColor(name) {
                let sum = 0;
                for (let i = 0; i < name.length; i++) {
                    sum += name.charCodeAt(i);
                }
                return avatarColors[sum % avatarColors.length];
            }
            
            // è·å–åå­—é¦–å­—æ¯ï¼ˆä¸­æ–‡å–ç¬¬ä¸€ä¸ªå­—ï¼Œè‹±æ–‡å–é¦–å­—æ¯å¤§å†™ï¼‰
            function getInitials(name) {
                if (!name) return '?';
                // å¦‚æœæ˜¯ä¸­æ–‡ï¼Œå–ç¬¬ä¸€ä¸ªå­—
                if (/[\u4e00-\u9fa5]/.test(name)) {
                    return name.charAt(0);
                }
                // å¦‚æœæ˜¯è‹±æ–‡ï¼Œå–é¦–å­—æ¯å¤§å†™
                return name.charAt(0).toUpperCase();
            }
            
            // ç”Ÿæˆçº¯è‰²å¤´åƒHTML
            function generateSolidAvatar(name, size = 'small') {
                const colorClass = getAvatarColor(name);
                const initials = getInitials(name);
                
                if (size === 'large') {
                    return `<div class="friend-profile-img ${colorClass}">${initials}</div>`;
                } else {
                    return `<div class="friend-avatar ${colorClass}">${initials}</div>`;
                }
            }
            
            // æ¨¡æ‹Ÿæ•°æ® - åˆå§‹å¥½å‹æ¡£æ¡ˆ
            let friendsData = JSON.parse(localStorage.getItem('friendsData')) || [
                {
                    id: 1,
                    name: "å°å¯çˆ±",
                    adminMessage: "äº²çˆ±çš„å°å¯çˆ±ï¼Œè®¤è¯†ä½ æ˜¯æˆ‘æœ€å¼€å¿ƒçš„äº‹æƒ…ï¼æ¯æ¬¡å’Œä½ èŠå¤©éƒ½æ„Ÿè§‰ç‰¹åˆ«æ¸©æš–ï¼Œå¸Œæœ›æˆ‘ä»¬çš„å‹è°Šé•¿å­˜ï¼",
                    avatarColor: 'avatar-color-1',
                    photos: [
                        {url: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80", time: "2023-10-10 14:30", type: "photo"},
                        {url: "https://images.unsplash.com/photo-1517841905240-472988babdf9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80", time: "2023-10-12 09:15", type: "photo"},
                        {url: "https://images.unsplash.com/photo-1519281682544-5f37c4b14c47?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80", time: "2023-10-15 18:45", type: "photo"}
                    ],
                    messages: [
                        { sender: "ğŸ¥¬", content: "äº²çˆ±çš„å°å¯çˆ±ï¼Œè®¤è¯†ä½ æ˜¯æˆ‘æœ€å¼€å¿ƒçš„äº‹æƒ…ï¼æ¯æ¬¡å’Œä½ èŠå¤©éƒ½æ„Ÿè§‰ç‰¹åˆ«æ¸©æš–ï¼Œå¸Œæœ›æˆ‘ä»¬çš„å‹è°Šé•¿å­˜ï¼", time: "2023-10-01 12:00", type: "message" },
                        { sender: "ğŸ¥¬", content: "æœ€è¿‘å¤©æ°”è½¬å‡‰äº†ï¼Œè®°å¾—å¤šç©¿è¡£æœå“¦ï¼", time: "2023-10-16 09:15", type: "message" },
                        { sender: "å°å¯çˆ±", content: "ğŸ¥¬ï¼Œè°¢è°¢ä½ è¿™ä¹ˆæ¸©æš–çš„ç•™è¨€ï¼æˆ‘ä¹Ÿè¶…çº§å–œæ¬¢å’Œä½ åšæœ‹å‹ï¼", time: "2023-10-15 14:30", type: "message" },
                        { sender: "å°å¯çˆ±", content: "ä½ ä¹Ÿæ˜¯ï¼å‘¨æœ«æœ‰ç©ºä¸€èµ·å–å¥¶èŒ¶å—ï¼Ÿ", time: "2023-10-16 18:45", type: "message" }
                    ],
                    timeline: [] // è¿™ä¸ªå°†ç”±photoså’Œmessagesåˆå¹¶ç”Ÿæˆ
                },
                {
                    id: 2,
                    name: "é˜³å…‰",
                    adminMessage: "é˜³å…‰ï¼Œä½ å°±åƒä½ çš„åå­—ä¸€æ ·ï¼Œæ€»æ˜¯èƒ½å¸¦ç»™æˆ‘æ­£èƒ½é‡ï¼è°¢è°¢ä½ ä¸€ç›´ä»¥æ¥çš„æ”¯æŒå’Œé¼“åŠ±ï½",
                    avatarColor: 'avatar-color-2',
                    photos: [
                        {url: "https://images.unsplash.com/photo-1519058082700-08a0b56da9b4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80", time: "2023-10-05 11:20", type: "photo"},
                        {url: "https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80", time: "2023-10-08 16:45", type: "photo"}
                    ],
                    messages: [
                        { sender: "ğŸ¥¬", content: "é˜³å…‰ï¼Œä½ å°±åƒä½ çš„åå­—ä¸€æ ·ï¼Œæ€»æ˜¯èƒ½å¸¦ç»™æˆ‘æ­£èƒ½é‡ï¼è°¢è°¢ä½ ä¸€ç›´ä»¥æ¥çš„æ”¯æŒå’Œé¼“åŠ±ï½", time: "2023-10-01 10:30", type: "message" },
                        { sender: "é˜³å…‰", content: "ğŸ¥¬ä½ å¤ªä¼šå¤¸äººäº†ï¼å’Œä½ åœ¨ä¸€èµ·æ€»æ˜¯å¾ˆå¼€å¿ƒï¼", time: "2023-10-10 11:20", type: "message" }
                    ],
                    timeline: []
                }
            ];
            
            // ä¸ºç°æœ‰æ•°æ®ç”Ÿæˆæ—¶é—´çº¿
            function updateTimelineForAllFriends() {
                friendsData.forEach(friend => {
                    if (!friend.photos) friend.photos = [];
                    if (!friend.messages) friend.messages = [];
                    
                    // åˆå¹¶æ‰€æœ‰æ—¶é—´çº¿é¡¹ç›®
                    friend.timeline = [];
                    
                    // æ·»åŠ æ‰€æœ‰ç…§ç‰‡
                    friend.photos.forEach(photo => {
                        friend.timeline.push({
                            ...photo,
                            sender: "ğŸ¥¬",
                            type: "photo"
                        });
                    });
                    
                    // æ·»åŠ æ‰€æœ‰ç•™è¨€
                    friend.messages.forEach(message => {
                        friend.timeline.push({
                            ...message,
                            type: "message"
                        });
                    });
                    
                    // æŒ‰æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
                    friend.timeline.sort((a, b) => new Date(b.time) - new Date(a.time));
                    
                    // ä¸ºå·²æœ‰æ•°æ®æ·»åŠ é¢œè‰²å±æ€§
                    if (!friend.avatarColor) {
                        friend.avatarColor = getAvatarColor(friend.name);
                    }
                });
            }
            
            // åˆå§‹åŒ–æ—¶é—´çº¿
            updateTimelineForAllFriends();
            
            // å½“å‰é€‰ä¸­çš„å¥½å‹ï¼ˆç”¨æˆ·è§†è§’ï¼‰
            let currentFriend = null;
            // å½“å‰æ—¶é—´çº¿è¿‡æ»¤å™¨
            let currentFilter = "all";
            // å½“å‰æ­£åœ¨ç®¡ç†çš„å¥½å‹
            let managingFriend = null;
            
            // ç®¡ç†å‘˜å¯†ç 
            const ADMIN_PASSWORD = "v05708";
            
            // DOM å…ƒç´ 
            const adminBtn = document.getElementById('admin-btn');
            const userBtn = document.getElementById('user-btn');
            const adminView = document.getElementById('admin-view');
            const userView = document.getElementById('user-view');
            const passwordSection = document.getElementById('password-section');
            const adminContent = document.getElementById('admin-content');
            const loginBtn = document.getElementById('login-btn');
            const adminPasswordInput = document.getElementById('admin-password');
            const friendForm = document.getElementById('friend-form');
            const friendNameInput = document.getElementById('friend-name');
            const adminMessageInput = document.getElementById('admin-message');
            const photosUpload = document.getElementById('photos-upload');
            const photosInput = document.getElementById('photos-input');
            const photosPreview = document.getElementById('photos-preview');
            const photosCount = document.getElementById('photos-count');
            const friendList = document.getElementById('friend-list');
            const userNameInput = document.getElementById('user-name');
            const searchBtn = document.getElementById('search-btn');
            const userResult = document.getElementById('user-result');
            const timelineSection = document.getElementById('timeline-section');
            const newMessageSection = document.getElementById('new-message-section');
            const userMessageInput = document.getElementById('user-message');
            const sendMessageBtn = document.getElementById('send-message-btn');
            const notificationContainer = document.getElementById('notification-container');
            const timelineFilter = document.getElementById('timeline-filter');
            const adminBackBtn = document.getElementById('admin-back-btn');
            const userBackBtn = document.getElementById('user-back-btn');
            
            // ç®¡ç†æ¨¡æ€æ¡†å…ƒç´ 
            const manageFriendModal = document.getElementById('manage-friend-modal');
            const closeManageModalBtn = document.getElementById('close-manage-modal');
            const manageFriendNameInput = document.getElementById('manage-friend-name');
            const manageAdminMessageInput = document.getElementById('manage-admin-message');
            const existingPhotosContainer = document.getElementById('existing-photos');
            const managePhotosUpload = document.getElementById('manage-photos-upload');
            const managePhotosInput = document.getElementById('manage-photos-input');
            const managePhotosPreview = document.getElementById('manage-photos-preview');
            const managePhotosCount = document.getElementById('manage-photos-count');
            const manageNewMessageInput = document.getElementById('manage-new-message');
            const saveManageBtn = document.getElementById('save-manage-btn');
            const addMessageBtn = document.getElementById('add-message-btn');
            
            // å­˜å‚¨å·²é€‰æ‹©ä½†æœªä¸Šä¼ çš„ç…§ç‰‡ï¼ˆåˆ›å»ºæ–°æ¡£æ¡ˆï¼‰
            let selectedPhotos = [];
            // å­˜å‚¨å·²é€‰æ‹©ä½†æœªä¸Šä¼ çš„ç…§ç‰‡ï¼ˆç®¡ç†æ¡£æ¡ˆï¼‰
            let selectedManagePhotos = [];
            
            // è§†è§’åˆ‡æ¢
            adminBtn.addEventListener('click', () => {
                adminBtn.classList.add('active');
                userBtn.classList.remove('active');
                adminView.classList.add('active');
                userView.classList.remove('active');
                
                // é‡ç½®ç®¡ç†å‘˜ç™»å½•çŠ¶æ€
                adminContent.classList.add('hidden');
                passwordSection.classList.remove('hidden');
                adminPasswordInput.value = '';
            });
            
            userBtn.addEventListener('click', () => {
                userBtn.classList.add('active');
                adminBtn.classList.remove('active');
                userView.classList.add('active');
                adminView.classList.remove('active');
                
                // é‡ç½®ç”¨æˆ·æœç´¢
                resetUserSearch();
                currentFriend = null;
            });
            
            // ç®¡ç†å‘˜ç™»å½•
            loginBtn.addEventListener('click', () => {
                const password = adminPasswordInput.value;
                
                if (password === ADMIN_PASSWORD) {
                    passwordSection.classList.add('hidden');
                    adminContent.classList.remove('hidden');
                    showNotification('æ¬¢è¿å›æ¥ï¼ŒğŸ¥¬ï¼', 'success');
                    loadFriendsList();
                } else {
                    showNotification('å¯†ç ä¸å¯¹å“¦ï¼Œå†è¯•è¯•çœ‹ï¼', 'error');
                    adminPasswordInput.value = '';
                    adminPasswordInput.focus();
                }
            });
            
            // ç®¡ç†å‘˜è¿”å›ç™»å½•æŒ‰é’®
            adminBackBtn.addEventListener('click', () => {
                adminContent.classList.add('hidden');
                passwordSection.classList.remove('hidden');
                adminPasswordInput.value = '';
            });
            
            // ç”¨æˆ·è¿”å›æœç´¢æŒ‰é’®
            userBackBtn.addEventListener('click', () => {
                resetUserSearch();
                currentFriend = null;
            });
            
            // é‡ç½®ç”¨æˆ·æœç´¢ç•Œé¢
            function resetUserSearch() {
                userResult.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-heart"></i>
                        <p>è¾“å…¥ä½ çš„åå­—ï¼Œçœ‹çœ‹ğŸ¥¬ç»™ä½ ç•™äº†ä»€ä¹ˆè¯</p>
                    </div>
                `;
                timelineSection.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-clock"></i>
                        <p>æ‰¾åˆ°ä½ çš„æ¡£æ¡ˆåï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ğŸ¥¬ä¸ºä½ è®°å½•çš„æ—¶å…‰</p>
                    </div>
                `;
                newMessageSection.classList.add('hidden');
                userNameInput.value = '';
                userBackBtn.classList.add('hidden');
            }
            
            // å¤šç…§ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼ˆåˆ›å»ºæ–°æ¡£æ¡ˆï¼‰
            photosUpload.addEventListener('click', () => {
                photosInput.click();
            });
            
            photosInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                
                if (files.length === 0) return;
                
                // é™åˆ¶æœ€å¤šä¸Šä¼ 9å¼ ç…§ç‰‡
                if (selectedPhotos.length + files.length > 9) {
                    showNotification('æœ€å¤šåªèƒ½ä¸Šä¼ 9å¼ ç…§ç‰‡å“¦ï¼', 'error');
                    return;
                }
                
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        // ä¸ºæ¯å¼ ç…§ç‰‡ç”Ÿæˆå”¯ä¸€IDå’Œæ—¶é—´æˆ³
                        const photoId = Date.now() + Math.random();
                        const uploadTime = new Date().toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        }).replace(/\//g, '-');
                        
                        selectedPhotos.push({
                            id: photoId,
                            url: event.target.result,
                            time: uploadTime,
                            type: 'photo'
                        });
                        
                        updatePhotosPreview();
                    };
                    reader.readAsDataURL(file);
                });
                
                // é‡ç½®æ–‡ä»¶è¾“å…¥ï¼Œä»¥ä¾¿å¯ä»¥å†æ¬¡é€‰æ‹©ç›¸åŒæ–‡ä»¶
                photosInput.value = '';
            });
            
            // æ›´æ–°ç…§ç‰‡é¢„è§ˆï¼ˆåˆ›å»ºæ–°æ¡£æ¡ˆï¼‰
            function updatePhotosPreview() {
                photosPreview.innerHTML = '';
                photosCount.textContent = selectedPhotos.length;
                
                if (selectedPhotos.length === 0) {
                    photosUpload.style.display = 'block';
                    return;
                }
                
                photosUpload.style.display = 'none';
                
                selectedPhotos.forEach((photo, index) => {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-item';
                    photoItem.innerHTML = `
                        <img src="${photo.url}" alt="é¢„è§ˆç…§ç‰‡ ${index + 1}">
                        <div class="photo-info">
                            <div>ç…§ç‰‡ ${index + 1}</div>
                            <div class="photo-time">${photo.time}</div>
                        </div>
                        <button class="remove-photo" data-id="${photo.id}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    photosPreview.appendChild(photoItem);
                });
                
                // æ·»åŠ åˆ é™¤ç…§ç‰‡äº‹ä»¶
                document.querySelectorAll('.remove-photo').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const photoId = e.currentTarget.getAttribute('data-id');
                        selectedPhotos = selectedPhotos.filter(photo => photo.id != photoId);
                        updatePhotosPreview();
                    });
                });
            }
            
            // åˆ›å»ºå¥½å‹æ¡£æ¡ˆï¼ˆä¿®å¤ç‰ˆ - ç¡®ä¿å®æ—¶æ˜¾ç¤ºï¼‰
            friendForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = friendNameInput.value.trim();
                const adminMessage = adminMessageInput.value.trim();
                
                if (!name) {
                    showNotification('è¯·è¾“å…¥å¥½å‹çš„åå­—å“¦ï¼', 'error');
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåå¥½å‹
                const existingFriend = friendsData.find(friend => friend.name === name);
                if (existingFriend) {
                    showNotification('å·²ç»æœ‰åŒåå¥½å‹çš„æ¡£æ¡ˆå•¦ï¼æ¢ä¸ªåå­—è¯•è¯•ï¼Ÿ', 'error');
                    return;
                }
                
                // ç”Ÿæˆæ–°å¥½å‹ID
                const newId = friendsData.length > 0 ? Math.max(...friendsData.map(f => f.id)) + 1 : 1;
                
                // è·å–å½“å‰æ—¶é—´
                const now = new Date();
                const timeString = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(/\//g, '-');
                
                // ç”Ÿæˆå¤´åƒé¢œè‰²
                const avatarColor = getAvatarColor(name);
                
                // åˆ›å»ºæ–°å¥½å‹æ¡£æ¡ˆ
                const newFriend = {
                    id: newId,
                    name: name,
                    adminMessage: adminMessage || "ğŸ¥¬æƒ³å¯¹ä½ è¯´ï¼šå¾ˆé«˜å…´è®¤è¯†ä½ ï¼",
                    avatarColor: avatarColor,
                    photos: [],
                    messages: [],
                    timeline: []
                };
                
                // æ·»åŠ ç…§ç‰‡
                selectedPhotos.forEach(photo => {
                    const photoObj = {
                        url: photo.url,
                        time: photo.time,
                        type: 'photo'
                    };
                    newFriend.photos.push(photoObj);
                    newFriend.timeline.push({
                        ...photoObj,
                        sender: "ğŸ¥¬",
                        type: "photo"
                    });
                });
                
                // æ·»åŠ åˆå§‹ç•™è¨€
                const initialMessage = {
                    sender: "ğŸ¥¬",
                    content: adminMessage || "ğŸ¥¬æƒ³å¯¹ä½ è¯´ï¼šå¾ˆé«˜å…´è®¤è¯†ä½ ï¼",
                    time: timeString,
                    type: "message"
                };
                newFriend.messages.push(initialMessage);
                newFriend.timeline.push(initialMessage);
                
                // æ’åºæ—¶é—´çº¿ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
                newFriend.timeline.sort((a, b) => new Date(b.time) - new Date(a.time));
                
                // æ·»åŠ åˆ°æ•°æ®æ•°ç»„
                friendsData.push(newFriend);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('friendsData', JSON.stringify(friendsData));
                
                // é‡ç½®è¡¨å•
                friendForm.reset();
                selectedPhotos = [];
                updatePhotosPreview();
                photosUpload.style.display = 'block'; // ç¡®ä¿ä¸Šä¼ åŒºåŸŸé‡æ–°æ˜¾ç¤º
                
                // ç«‹å³é‡æ–°åŠ è½½å¥½å‹åˆ—è¡¨ï¼ˆä½¿ç”¨å»¶æ—¶ç¡®ä¿DOMæ›´æ–°ï¼‰
                setTimeout(() => {
                    loadFriendsList();
                    showNotification(`å¥½å‹ "${name}" çš„æ¡£æ¡ˆåˆ›å»ºæˆåŠŸï¼ğŸ¥¬`, 'success');
                }, 50);
            });
            
            // åŠ è½½å¥½å‹åˆ—è¡¨ï¼ˆä¿®å¤ç‰ˆ - ç¡®ä¿å®æ—¶æ›´æ–°ï¼‰
            function loadFriendsList() {
                console.log("å¼€å§‹åŠ è½½å¥½å‹åˆ—è¡¨...");
                
                // å¼ºåˆ¶ä»localStorageé‡æ–°è¯»å–æ•°æ®ï¼ˆç¡®ä¿æ•°æ®æœ€æ–°ï¼‰
                const freshData = localStorage.getItem('friendsData');
                if (freshData) {
                    try {
                        friendsData = JSON.parse(freshData);
                        console.log("é‡æ–°åŠ è½½çš„æ•°æ®:", friendsData);
                    } catch (e) {
                        console.error("è§£ææœ¬åœ°å­˜å‚¨æ•°æ®å¤±è´¥:", e);
                    }
                }
                
                if (friendsData.length === 0) {
                    friendList.innerHTML = `
                        <div class="no-data">
                            <i class="fas fa-users"></i>
                            <p>è¿˜æ²¡æœ‰å¥½å‹æ¡£æ¡ˆï¼Œå¿«ä¸ºä½ çš„æœ‹å‹åˆ›å»ºä¸€ä¸ªå§ï¼</p>
                        </div>
                    `;
                    return;
                }
                
                // æ¸…ç©ºå½“å‰åˆ—è¡¨
                friendList.innerHTML = '';
                
                friendsData.forEach(friend => {
                    // ç”Ÿæˆçº¯è‰²å¤´åƒHTML
                    const avatarHtml = generateSolidAvatar(friend.name, 'small');
                    
                    const friendItem = document.createElement('div');
                    friendItem.className = 'friend-item';
                    friendItem.innerHTML = `
                        ${avatarHtml}
                        <div class="friend-info">
                            <h4>${friend.name}</h4>
                            <p>${friend.adminMessage.substring(0, 60)}${friend.adminMessage.length > 60 ? '...' : ''}</p>
                            <p style="font-size: 0.9rem; color: var(--accent-color); margin-top: 5px;">
                                <i class="fas fa-images"></i> ${friend.photos ? friend.photos.length : 0} å¼ ç…§ç‰‡ Â· 
                                <i class="fas fa-comments"></i> ${friend.messages ? friend.messages.length : 0} æ¡ç•™è¨€
                            </p>
                        </div>
                        <div class="friend-actions">
                            <button class="action-btn view-friend-btn" data-id="${friend.id}">
                                <i class="fas fa-heart"></i>
                            </button>
                            <button class="action-btn manage-friend-btn" data-id="${friend.id}">
                                <i class="fas fa-cog"></i>
                            </button>
                            <button class="action-btn delete-friend-btn" data-id="${friend.id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    `;
                    
                    friendList.appendChild(friendItem);
                });
                
                // æ·»åŠ æŸ¥çœ‹å’Œåˆ é™¤äº‹ä»¶ç›‘å¬
                document.querySelectorAll('.view-friend-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const friendId = parseInt(e.currentTarget.getAttribute('data-id'));
                        viewFriend(friendId);
                    });
                });
                
                // æ·»åŠ ç®¡ç†äº‹ä»¶ç›‘å¬
                document.querySelectorAll('.manage-friend-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const friendId = parseInt(e.currentTarget.getAttribute('data-id'));
                        openManageModal(friendId);
                    });
                });
                
                document.querySelectorAll('.delete-friend-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const friendId = parseInt(e.currentTarget.getAttribute('data-id'));
                        deleteFriend(friendId);
                    });
                });
            }
            
            // æ‰“å¼€ç®¡ç†æ¨¡æ€æ¡†
            function openManageModal(friendId) {
                const friend = friendsData.find(f => f.id === friendId);
                if (!friend) return;
                
                managingFriend = friend;
                
                // å¡«å……æ¨¡æ€æ¡†å†…å®¹
                manageFriendNameInput.value = friend.name;
                manageAdminMessageInput.value = friend.adminMessage;
                manageNewMessageInput.value = '';
                
                // æ˜¾ç¤ºå·²æœ‰ç…§ç‰‡
                displayExistingPhotos(friend);
                
                // é‡ç½®ç®¡ç†ç…§ç‰‡ä¸Šä¼ åŒºåŸŸ
                selectedManagePhotos = [];
                updateManagePhotosPreview();
                
                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                manageFriendModal.classList.add('active');
            }
            
            // æ˜¾ç¤ºå·²æœ‰ç…§ç‰‡
            function displayExistingPhotos(friend) {
                existingPhotosContainer.innerHTML = '';
                
                if (!friend.photos || friend.photos.length === 0) {
                    existingPhotosContainer.innerHTML = `
                        <div class="no-data" style="padding: 20px; grid-column: 1 / -1;">
                            <i class="fas fa-images"></i>
                            <p>è¿˜æ²¡æœ‰ä¸Šä¼ ç…§ç‰‡</p>
                        </div>
                    `;
                    return;
                }
                
                friend.photos.forEach((photo, index) => {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'existing-photo-item';
                    photoItem.innerHTML = `
                        <img src="${photo.url}" alt="å·²æœ‰ç…§ç‰‡ ${index + 1}">
                        <div class="existing-photo-time">${photo.time}</div>
                        <button class="remove-existing-photo" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    existingPhotosContainer.appendChild(photoItem);
                });
                
                // æ·»åŠ åˆ é™¤å·²æœ‰ç…§ç‰‡äº‹ä»¶
                document.querySelectorAll('.remove-existing-photo').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const photoIndex = parseInt(e.currentTarget.getAttribute('data-index'));
                        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ ç…§ç‰‡å—ï¼Ÿ')) {
                            managingFriend.photos.splice(photoIndex, 1);
                            // æ›´æ–°æ—¶é—´çº¿
                            updateFriendTimeline(managingFriend);
                            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                            localStorage.setItem('friendsData', JSON.stringify(friendsData));
                            // é‡æ–°æ˜¾ç¤ºå·²æœ‰ç…§ç‰‡
                            displayExistingPhotos(managingFriend);
                            // é‡æ–°åŠ è½½å¥½å‹åˆ—è¡¨
                            loadFriendsList();
                            showNotification('ç…§ç‰‡åˆ é™¤æˆåŠŸï¼', 'info');
                        }
                    });
                });
            }
            
            // å¤šç…§ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼ˆç®¡ç†æ¡£æ¡ˆï¼‰
            managePhotosUpload.addEventListener('click', () => {
                managePhotosInput.click();
            });
            
            managePhotosInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                
                if (files.length === 0) return;
                
                // é™åˆ¶æœ€å¤šä¸Šä¼ 9å¼ ç…§ç‰‡
                if (selectedManagePhotos.length + files.length > 9) {
                    showNotification('æœ€å¤šåªèƒ½ä¸Šä¼ 9å¼ ç…§ç‰‡å“¦ï¼', 'error');
                    return;
                }
                
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        // ä¸ºæ¯å¼ ç…§ç‰‡ç”Ÿæˆå”¯ä¸€IDå’Œæ—¶é—´æˆ³
                        const photoId = Date.now() + Math.random();
                        const uploadTime = new Date().toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        }).replace(/\//g, '-');
                        
                        selectedManagePhotos.push({
                            id: photoId,
                            url: event.target.result,
                            time: uploadTime,
                            type: 'photo'
                        });
                        
                        updateManagePhotosPreview();
                    };
                    reader.readAsDataURL(file);
                });
                
                // é‡ç½®æ–‡ä»¶è¾“å…¥ï¼Œä»¥ä¾¿å¯ä»¥å†æ¬¡é€‰æ‹©ç›¸åŒæ–‡ä»¶
                managePhotosInput.value = '';
            });
            
            // æ›´æ–°ç®¡ç†ç…§ç‰‡é¢„è§ˆ
            function updateManagePhotosPreview() {
                managePhotosPreview.innerHTML = '';
                managePhotosCount.textContent = selectedManagePhotos.length;
                
                if (selectedManagePhotos.length === 0) {
                    managePhotosUpload.style.display = 'block';
                    return;
                }
                
                managePhotosUpload.style.display = 'none';
                
                selectedManagePhotos.forEach((photo, index) => {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-item';
                    photoItem.innerHTML = `
                        <img src="${photo.url}" alt="æ–°ç…§ç‰‡ ${index + 1}">
                        <div class="photo-info">
                            <div>æ–°ç…§ç‰‡ ${index + 1}</div>
                            <div class="photo-time">${photo.time}</div>
                        </div>
                        <button class="remove-photo" data-id="${photo.id}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    managePhotosPreview.appendChild(photoItem);
                });
                
                // æ·»åŠ åˆ é™¤ç…§ç‰‡äº‹ä»¶
                document.querySelectorAll('#manage-photos-preview .remove-photo').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const photoId = e.currentTarget.getAttribute('data-id');
                        selectedManagePhotos = selectedManagePhotos.filter(photo => photo.id != photoId);
                        updateManagePhotosPreview();
                    });
                });
            }
            
            // ä¿å­˜ç®¡ç†æ›´æ”¹
            saveManageBtn.addEventListener('click', () => {
                if (!managingFriend) return;
                
                // æ›´æ–°ç®¡ç†å‘˜ç•™è¨€
                managingFriend.adminMessage = manageAdminMessageInput.value.trim() || managingFriend.adminMessage;
                
                // æ·»åŠ æ–°ç…§ç‰‡
                if (selectedManagePhotos.length > 0) {
                    selectedManagePhotos.forEach(photo => {
                        managingFriend.photos.push({
                            url: photo.url,
                            time: photo.time,
                            type: 'photo'
                        });
                    });
                }
                
                // æ·»åŠ æ–°ç•™è¨€ï¼ˆå¦‚æœæœ‰ï¼‰
                const newMessageContent = manageNewMessageInput.value.trim();
                if (newMessageContent) {
                    const now = new Date();
                    const timeString = now.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    }).replace(/\//g, '-');
                    
                    const newMessage = {
                        sender: "ğŸ¥¬",
                        content: newMessageContent,
                        time: timeString,
                        type: 'message'
                    };
                    
                    managingFriend.messages.push(newMessage);
                }
                
                // æ›´æ–°å¥½å‹çš„æ—¶é—´çº¿
                updateFriendTimeline(managingFriend);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('friendsData', JSON.stringify(friendsData));
                
                // é‡ç½®ç®¡ç†ç…§ç‰‡ä¸Šä¼ åŒºåŸŸ
                selectedManagePhotos = [];
                updateManagePhotosPreview();
                manageNewMessageInput.value = '';
                
                // é‡æ–°æ˜¾ç¤ºå·²æœ‰ç…§ç‰‡
                displayExistingPhotos(managingFriend);
                
                // é‡æ–°åŠ è½½å¥½å‹åˆ—è¡¨
                setTimeout(() => {
                    loadFriendsList();
                }, 50);
                
                // å…³é—­æ¨¡æ€æ¡†
                manageFriendModal.classList.remove('active');
                
                showNotification(`å¥½å‹ "${managingFriend.name}" çš„æ¡£æ¡ˆå·²æ›´æ–°æˆåŠŸï¼ğŸ¥¬`, 'success');
            });
            
            // ä»…æ·»åŠ ç•™è¨€æŒ‰é’®
            addMessageBtn.addEventListener('click', () => {
                if (!managingFriend) return;
                
                const newMessageContent = manageNewMessageInput.value.trim();
                if (!newMessageContent) {
                    showNotification('è¯·è¾“å…¥ç•™è¨€å†…å®¹ï¼', 'error');
                    return;
                }
                
                const now = new Date();
                const timeString = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(/\//g, '-');
                
                const newMessage = {
                    sender: "ğŸ¥¬",
                    content: newMessageContent,
                    time: timeString,
                    type: 'message'
                };
                
                managingFriend.messages.push(newMessage);
                
                // æ›´æ–°å¥½å‹çš„æ—¶é—´çº¿
                updateFriendTimeline(managingFriend);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('friendsData', JSON.stringify(friendsData));
                
                // é‡ç½®ç•™è¨€è¾“å…¥æ¡†
                manageNewMessageInput.value = '';
                
                // é‡æ–°æ˜¾ç¤ºå·²æœ‰ç…§ç‰‡
                displayExistingPhotos(managingFriend);
                
                // é‡æ–°åŠ è½½å¥½å‹åˆ—è¡¨
                setTimeout(() => {
                    loadFriendsList();
                }, 50);
                
                showNotification(`å·²ä¸º "${managingFriend.name}" æ·»åŠ æ–°ç•™è¨€æˆåŠŸï¼ğŸ¥¬`, 'success');
            });
            
            // æ›´æ–°å¥½å‹æ—¶é—´çº¿
            function updateFriendTimeline(friend) {
                friend.timeline = [];
                
                // æ·»åŠ æ‰€æœ‰ç…§ç‰‡
                if (friend.photos && friend.photos.length > 0) {
                    friend.photos.forEach(photo => {
                        friend.timeline.push({
                            ...photo,
                            sender: "ğŸ¥¬",
                            type: "photo"
                        });
                    });
                }
                
                // æ·»åŠ æ‰€æœ‰ç•™è¨€
                if (friend.messages && friend.messages.length > 0) {
                    friend.messages.forEach(message => {
                        friend.timeline.push({
                            ...message,
                            type: "message"
                        });
                    });
                }
                
                // æŒ‰æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
                friend.timeline.sort((a, b) => new Date(b.time) - new Date(a.time));
            }
            
            // å…³é—­ç®¡ç†æ¨¡æ€æ¡†
            closeManageModalBtn.addEventListener('click', () => {
                manageFriendModal.classList.remove('active');
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            manageFriendModal.addEventListener('click', (e) => {
                if (e.target === manageFriendModal) {
                    manageFriendModal.classList.remove('active');
                }
            });
            
            // æŸ¥çœ‹å¥½å‹æ¡£æ¡ˆ
            function viewFriend(friendId) {
                const friend = friendsData.find(f => f.id === friendId);
                if (!friend) return;
                
                // åˆ‡æ¢åˆ°ç”¨æˆ·è§†è§’
                userBtn.click();
                
                // è®¾ç½®æœç´¢æ¡†
                userNameInput.value = friend.name;
                
                // æ˜¾ç¤ºå¥½å‹æ¡£æ¡ˆ
                displayFriendProfile(friend);
            }
            
            // åˆ é™¤å¥½å‹æ¡£æ¡ˆ
            function deleteFriend(friendId) {
                const friend = friendsData.find(f => f.id === friendId);
                if (!friend) return;
                
                if (confirm(`ç¡®å®šè¦åˆ é™¤å¥½å‹ "${friend.name}" çš„æ¡£æ¡ˆå—ï¼Ÿè¿™å°†ä¼šåˆ é™¤æ‰€æœ‰ç…§ç‰‡å’Œç•™è¨€è®°å½•ã€‚`)) {
                    friendsData = friendsData.filter(f => f.id !== friendId);
                    localStorage.setItem('friendsData', JSON.stringify(friendsData));
                    
                    // ç«‹å³é‡æ–°åŠ è½½å¥½å‹åˆ—è¡¨
                    setTimeout(() => {
                        loadFriendsList();
                        showNotification(`å¥½å‹ "${friend.name}" çš„æ¡£æ¡ˆå·²åˆ é™¤æˆåŠŸï¼`, 'info');
                    }, 50);
                }
            }
            
            // æ—¶é—´çº¿è¿‡æ»¤å™¨
            timelineFilter.addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-btn')) {
                    // æ›´æ–°æ´»åŠ¨æŒ‰é’®
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    e.target.classList.add('active');
                    
                    // æ›´æ–°è¿‡æ»¤å™¨
                    currentFilter = e.target.getAttribute('data-filter');
                    
                    // é‡æ–°æ¸²æŸ“æ—¶é—´çº¿
                    if (currentFriend) {
                        displayTimeline(currentFriend);
                    }
                }
            });
            
            // ç”¨æˆ·æœç´¢å¥½å‹æ¡£æ¡ˆ
            searchBtn.addEventListener('click', searchFriend);
            
            userNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchFriend();
                }
            });
            
            function searchFriend() {
                const name = userNameInput.value.trim();
                
                if (!name) {
                    showNotification('è¯·è¾“å…¥ä½ çš„åå­—å“¦ï¼', 'error');
                    return;
                }
                
                const friend = friendsData.find(f => f.name.toLowerCase() === name.toLowerCase());
                
                if (friend) {
                    displayFriendProfile(friend);
                } else {
                    userResult.innerHTML = `
                        <div class="no-data">
                            <i class="fas fa-user-slash"></i>
                            <p style="color: #FF7A7A;">è¯·ç§èŠğŸ¥¬å¹¶è€å¿ƒç­‰å¾…ä¸€ä¼šå“¦~</p>
                            <p style="margin-top: 10px; font-size: 1rem;">ğŸ¥¬è¿˜æ²¡æœ‰åˆ›å»ºä½ çš„æ¡£æ¡ˆ</p>
                        </div>
                    `;
                    
                    timelineSection.innerHTML = `
                        <div class="no-data">
                            <i class="fas fa-clock"></i>
                            <p>è¿˜æ²¡æœ‰æ—¶é—´çº¿è®°å½•</p>
                        </div>
                    `;
                    
                    newMessageSection.classList.add('hidden');
                    userBackBtn.classList.remove('hidden');
                    currentFriend = null;
                }
            }
            
            // æ˜¾ç¤ºå¥½å‹æ¡£æ¡ˆ
            function displayFriendProfile(friend) {
                currentFriend = friend;
                
                // ç”Ÿæˆçº¯è‰²å¤´åƒHTMLï¼ˆå¤§å°ºå¯¸ï¼‰
                const avatarHtml = generateSolidAvatar(friend.name, 'large');
                
                // æ˜¾ç¤ºå¥½å‹ä¿¡æ¯ï¼ˆä½¿ç”¨çº¯è‰²å¤´åƒï¼‰
                userResult.innerHTML = `
                    <div class="friend-profile">
                        <div class="friend-avatar-container">
                            ${avatarHtml}
                        </div>
                        <h3>${friend.name}</h3>
                        <p>æ¬¢è¿æ¥åˆ°ä½ çš„ä¸“å±æ¡£æ¡ˆï¼ğŸ¥¬ä¸ºä½ è®°å½•äº†ä¸€äº›ç¾å¥½æ—¶åˆ»ï½</p>
                    </div>
                `;
                
                // æ˜¾ç¤ºæ—¶é—´çº¿ï¼ˆåŒ…æ‹¬ç¬¬ä¸€æ¡ç•™è¨€ï¼Œç°åœ¨ä¸å…¶ä»–ç•™è¨€ä¸€æ ·æ˜¾ç¤ºï¼‰
                displayTimeline(friend);
                
                // æ˜¾ç¤ºç•™è¨€è¾“å…¥æ¡†
                newMessageSection.classList.remove('hidden');
                userMessageInput.value = '';
                userMessageInput.focus();
                
                // æ˜¾ç¤ºè¿”å›æŒ‰é’®
                userBackBtn.classList.remove('hidden');
            }
            
            // æ˜¾ç¤ºæ—¶é—´çº¿
            function displayTimeline(friend) {
                // ç¡®ä¿æ—¶é—´çº¿æ˜¯æœ€æ–°çš„
                updateFriendTimeline(friend);
                
                // è¿‡æ»¤æ—¶é—´çº¿é¡¹ç›®
                let filteredTimeline = friend.timeline;
                if (currentFilter === 'message') {
                    filteredTimeline = friend.timeline.filter(item => item.type === 'message');
                } else if (currentFilter === 'photo') {
                    filteredTimeline = friend.timeline.filter(item => item.type === 'photo');
                }
                
                if (filteredTimeline.length === 0) {
                    timelineSection.innerHTML = `
                        <div class="no-data">
                            <i class="fas fa-clock"></i>
                            <p>è¿˜æ²¡æœ‰æ—¶é—´çº¿è®°å½•</p>
                        </div>
                    `;
                    return;
                }
                
                timelineSection.innerHTML = '<div class="timeline">';
                
                filteredTimeline.forEach(item => {
                    const timelineItem = document.createElement('div');
                    timelineItem.className = 'timeline-item';
                    
                    if (item.type === 'message') {
                        timelineItem.innerHTML = `
                            <div class="timeline-icon">
                                <i class="fas fa-comment"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-sender">${item.sender}</span>
                                    <span class="timeline-time">${item.time}</span>
                                </div>
                                <div class="timeline-message">${item.content}</div>
                            </div>
                        `;
                    } else if (item.type === 'photo') {
                        timelineItem.innerHTML = `
                            <div class="timeline-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-sender">ğŸ¥¬ä¸Šä¼ çš„ç…§ç‰‡</span>
                                    <span class="timeline-time">${item.time}</span>
                                </div>
                                <div class="timeline-photos">
                                    <div class="timeline-photo">
                                        <img src="${item.url}" alt="ğŸ¥¬ä¸Šä¼ çš„ç…§ç‰‡">
                                        <div class="timeline-photo-time">${item.time}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    timelineSection.querySelector('.timeline').appendChild(timelineItem);
                });
                
                timelineSection.innerHTML += '</div>';
            }
            
            // å‘é€ç•™è¨€ï¼ˆç”¨æˆ·ï¼‰
            sendMessageBtn.addEventListener('click', () => {
                if (!currentFriend) {
                    showNotification('è¯·å…ˆæŸ¥æ‰¾ä½ çš„æ¡£æ¡ˆï¼', 'error');
                    return;
                }
                
                const message = userMessageInput.value.trim();
                
                if (!message) {
                    showNotification('è¯·è¾“å…¥ç•™è¨€å†…å®¹å“¦ï¼', 'error');
                    return;
                }
                
                // è·å–å½“å‰æ—¶é—´
                const now = new Date();
                const timeString = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(/\//g, '-');
                
                // åˆ›å»ºç•™è¨€å¯¹è±¡
                const newMessage = {
                    sender: currentFriend.name,
                    content: message,
                    time: timeString,
                    type: 'message'
                };
                
                // æ·»åŠ åˆ°æ¶ˆæ¯æ•°ç»„
                if (!currentFriend.messages) currentFriend.messages = [];
                currentFriend.messages.push(newMessage);
                
                // æ›´æ–°æ—¶é—´çº¿
                updateFriendTimeline(currentFriend);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('friendsData', JSON.stringify(friendsData));
                
                // é‡æ–°æ˜¾ç¤ºæ—¶é—´çº¿
                displayTimeline(currentFriend);
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                userMessageInput.value = '';
                
                showNotification('ç•™è¨€å‘é€æˆåŠŸï¼ğŸ¥¬ä¼šå¾ˆå¿«å›å¤ä½ çš„ï¼', 'success');
                
                // è‡ªåŠ¨æ·»åŠ ä¸€æ¡ğŸ¥¬å›å¤ï¼ˆæ¨¡æ‹Ÿï¼‰
                setTimeout(() => {
                    // éšæœºé€‰æ‹©ä¸€æ¡å›å¤
                    const replies = [
                        "æ”¶åˆ°ä½ çš„ç•™è¨€å•¦ï¼Œå¥½å¼€å¿ƒï¼",
                        "è°¢è°¢ä½ çš„ç•™è¨€ï¼Œæˆ‘ä¼šä¸€ç›´çæƒœæˆ‘ä»¬çš„å‹è°Šï¼",
                        "çœ‹åˆ°ä½ çš„ç•™è¨€å¿ƒé‡Œæš–æš–çš„ï¼",
                        "è°¢è°¢å…³å¿ƒï¼Œä½ ä¹Ÿè¦ç…§é¡¾å¥½è‡ªå·±å“¦ï¼",
                        "å·²æ”¶åˆ°ï¼ŒæœŸå¾…ä¸‹æ¬¡è§é¢ï¼",
                        "ä½ çš„ç•™è¨€è®©æˆ‘ä»Šå¤©çš„å¿ƒæƒ…éƒ½å˜å¥½äº†ï¼",
                        "å‹è°Šä¸‡å²ï¼ğŸ¥¬æ°¸è¿œæ˜¯ä½ çš„æœ‹å‹ï¼"
                    ];
                    
                    const randomReply = replies[Math.floor(Math.random() * replies.length)];
                    
                    // åˆ›å»ºå›å¤å¯¹è±¡
                    const replyMessage = {
                        sender: "ğŸ¥¬",
                        content: randomReply,
                        time: new Date(now.getTime() + 60000).toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        }).replace(/\//g, '-'),
                        type: 'message'
                    };
                    
                    // æ·»åŠ ğŸ¥¬å›å¤
                    currentFriend.messages.push(replyMessage);
                    
                    // æ›´æ–°æ—¶é—´çº¿
                    updateFriendTimeline(currentFriend);
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem('friendsData', JSON.stringify(friendsData));
                    
                    // é‡æ–°æ˜¾ç¤ºæ—¶é—´çº¿
                    displayTimeline(currentFriend);
                    
                    showNotification('ğŸ¥¬å›å¤äº†ä½ çš„ç•™è¨€ï¼', 'info');
                }, 2000);
            });
            
            // æ˜¾ç¤ºé€šçŸ¥
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `<span>${message}</span>`;
                
                notificationContainer.appendChild(notification);
                
                // 3ç§’åè‡ªåŠ¨ç§»é™¤
                setTimeout(() => {
                    notification.style.animation = 'slideIn 0.5s ease reverse';
                    setTimeout(() => {
                        notification.remove();
                    }, 500);
                }, 3000);
            }
            
            // åˆå§‹åŒ–é¡µé¢
            function init() {
                // åˆå§‹åŒ–æ—¶é—´çº¿
                updateTimelineForAllFriends();
                
                // åŠ è½½å¥½å‹åˆ—è¡¨
                loadFriendsList();
                
                // æ·»åŠ ä¸€äº›äº¤äº’æ•ˆæœ
                document.querySelectorAll('.btn').forEach(btn => {
                    btn.addEventListener('mousedown', () => {
                        btn.style.transform = 'translateY(0)';
                    });
                    
                    btn.addEventListener('mouseup', () => {
                        btn.style.transform = 'translateY(-3px)';
                    });
                    
                    btn.addEventListener('mouseleave', () => {
                        btn.style.transform = 'translateY(0)';
                    });
                });
            }
            
            // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
            init();
            
        }); // DOMContentLoaded ç»“æŸ
    </script>
</body>
</html>
